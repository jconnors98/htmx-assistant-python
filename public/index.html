<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TalentCentral Assistant</title>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <link rel="stylesheet" href="/App.css" />
</head>
<body>
  <div class="app-container">
    <h1>Builders Life TalentCentral Assistant</h1>

    <p class="intro">
      Your one-stop destination for construction jobs and career support in BC.
      Whether you're just starting out, changing careers, or looking to grow in the
      construction industry, we connect you with job opportunities, training programs,
      and resources from the British Columbia Construction Association (BCCA) and its partners.
      Start here to explore the tools and support you need to build your future in construction.
    </p>

    <!-- Chat Container -->
    <div id="chat-box" class="chat-box">
      <!-- Assistant prompt buttons as initial message -->
      <div class="chat-entry assistant">
        <div class="bubble">
          <p>How can I help you today?</p>
          <div class="prompt-buttons">
            <button
              class="prompt-button"
              hx-post="/ask"
              hx-vals='{"message":"What programs are available?"}'
              hx-target="#chat-box"
              hx-swap="beforeend">What programs are available?</button>

            <button
              class="prompt-button"
              hx-post="/ask"
              hx-vals='{"message":"How do I apply?"}'
              hx-target="#chat-box"
              hx-swap="beforeend">How do I apply?</button>

            <button
              class="prompt-button"
              hx-post="/ask"
              hx-vals='{"message":"Where is the job board?"}'
              hx-target="#chat-box"
              hx-swap="beforeend">Where is the job board?</button>
          </div>
        </div>
      </div>

      <!-- Messages will appear below -->
      <div id="chat-end"></div>
    </div>

    <!-- Input Area -->
    <form id="form"
      hx-post="/ask"
      hx-target="#chat-box"
      hx-swap="beforeend"
      onsubmit="setTimeout(() => this.reset(), 100); return true;"
    >
      <textarea
        id="prompt"
        name="message"
        placeholder="Ask the Assistant about jobs, training programs, or how to apply..."
        required
      ></textarea>

      <!-- Right-aligned buttons -->
      <div class="button-row">
        <button type="submit">Send</button>
        <button type="button" onclick="document.getElementById('chat-box').innerHTML = ''">
          Clear Chat
        </button>
      </div>
    </form>
  </div>

  <!-- Typing Animation -->
  <script>
    document.body.addEventListener("htmx:beforeRequest", function () {
      const typing = document.createElement("div");
      typing.className = "chat-entry assistant typing";
      typing.id = "thinking-bubble";
      typing.innerHTML = `
        <div class="bubble typing">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>`;
      document.getElementById("chat-box").appendChild(typing);
    });

    document.body.addEventListener("htmx:afterSwap", function () {
      const typing = document.getElementById("thinking-bubble");
      if (typing) typing.remove();
      document.getElementById("chat-end")?.scrollIntoView({ behavior: "smooth" });
    });
  </script>
</body>
</html>
