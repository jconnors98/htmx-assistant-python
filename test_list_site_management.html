<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Test Enhanced Site Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#82002d',
            'primary-light': '#a0003f',
            'primary-dark': '#6b0024',
            secondary: '#f8fafc',
            accent: '#e2e8f0'
          },
          boxShadow: {
            'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
            'medium': '0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
            'strong': '0 10px 40px -10px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'pulse-soft': 'pulseSoft 2s infinite'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            pulseSoft: {
              '0%, 100%': { opacity: '1' },
              '50%': { opacity: '0.8' }
            }
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 p-8">
  <div class="max-w-6xl mx-auto">
    <!-- Header Section -->
    <div class="bg-white rounded-2xl shadow-soft border border-gray-100 p-8 mb-8 animate-fade-in">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-10 h-10 bg-gradient-to-br from-primary to-primary-light rounded-xl flex items-center justify-center shadow-medium">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Enhanced Site Management Test</h1>
          <p class="text-gray-600 text-sm">Test the new professional site management interface</p>
        </div>
      </div>
    </div>
    
    <!-- Site Management Section -->
    <section class="bg-white rounded-2xl shadow-soft border border-gray-100 p-8 mb-8 animate-slide-up">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900">Site Management</h2>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Preferred Sites Section -->
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200 shadow-soft">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-green-800">Preferred Sites</h3>
                <p class="text-sm text-green-600">Sites to prioritize in search results</p>
              </div>
            </div>
            <div class="text-right">
              <div id="preferred-count" class="text-xs text-green-600 font-medium bg-green-100 px-2 py-1 rounded-full">0/30 sites</div>
            </div>
          </div>
          
          <div class="mb-4">
            <div class="flex gap-3">
              <input id="preferred-site-input" type="text" class="flex-1 px-4 py-3 border border-green-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm hover:shadow-md" placeholder="Enter site URL or wildcard (e.g., https://example.com or *.example.com)" />
              <button id="add-preferred-site" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl font-medium shadow-medium hover:shadow-strong transition-all duration-200 transform hover:-translate-y-0.5 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add
              </button>
            </div>
          </div>
          
          <div id="preferred-sites-list" class="space-y-3 max-h-80 overflow-y-auto">
            <!-- Sites will be added here -->
          </div>
        </div>

        <!-- Blocked Sites Section -->
        <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl p-6 border border-red-200 shadow-soft">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-red-800">Blocked Sites</h3>
                <p class="text-sm text-red-600">Sites to exclude from search results</p>
              </div>
            </div>
            <div class="text-right">
              <div id="blocked-count" class="text-xs text-red-600 font-medium bg-red-100 px-2 py-1 rounded-full">0/30 sites</div>
            </div>
          </div>
          
          <div class="mb-4">
            <div class="flex gap-3">
              <input id="blocked-site-input" type="text" class="flex-1 px-4 py-3 border border-red-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm hover:shadow-md" placeholder="Enter site URL or wildcard (e.g., https://example.com or *.example.com)" />
              <button id="add-blocked-site" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-3 rounded-xl font-medium shadow-medium hover:shadow-strong transition-all duration-200 transform hover:-translate-y-0.5 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add
              </button>
            </div>
          </div>
          
          <div id="blocked-sites-list" class="space-y-3 max-h-80 overflow-y-auto">
            <!-- Sites will be added here -->
          </div>
        </div>
      </div>
    </section>
    
    <!-- Test Results Section -->
    <section class="bg-white rounded-2xl shadow-soft border border-gray-100 p-8 animate-slide-up">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-gradient-to-br from-primary to-primary-light rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900">Test Results</h2>
      </div>
      
      <div id="test-results" class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200 mb-6">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <p class="text-blue-800 font-medium">Add some sites above and click "Test Functionality" to see the results.</p>
            <p class="text-blue-600 text-sm mt-1">Test all the enhanced features including wildcard support and site limits.</p>
          </div>
        </div>
      </div>
      
      <button id="test-btn" class="bg-gradient-to-r from-primary to-primary-light hover:from-primary-dark hover:to-primary text-white px-8 py-4 rounded-xl font-semibold shadow-medium hover:shadow-strong transition-all duration-200 transform hover:-translate-y-0.5 flex items-center gap-3 text-lg">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Test Enhanced Functionality
      </button>
    </section>
  </div>

  <script>
    let modePreferredSites = [];
    let modeBlockedSites = [];
    const MAX_PREFERRED_SITES = 30;
    const MAX_BLOCKED_SITES = 30;

    function updateSiteCounts() {
      const preferredCountEl = document.getElementById('preferred-count');
      const blockedCountEl = document.getElementById('blocked-count');
      
      if (preferredCountEl) {
        const count = modePreferredSites.length;
        const isAtLimit = count >= MAX_PREFERRED_SITES;
        preferredCountEl.textContent = `${count}/${MAX_PREFERRED_SITES} sites`;
        preferredCountEl.className = `text-xs ${isAtLimit ? 'text-red-500 font-semibold' : 'text-gray-400'}`;
      }
      
      if (blockedCountEl) {
        const count = modeBlockedSites.length;
        const isAtLimit = count >= MAX_BLOCKED_SITES;
        blockedCountEl.textContent = `${count}/${MAX_BLOCKED_SITES} sites`;
        blockedCountEl.className = `text-xs ${isAtLimit ? 'text-red-500 font-semibold' : 'text-gray-400'}`;
      }
    }

    function renderSiteLists(preferredSites, blockedSites) {
      modePreferredSites = [...(preferredSites || [])];
      modeBlockedSites = [...(blockedSites || [])];
      
      renderPreferredSitesList();
      renderBlockedSitesList();
      updateSiteCounts();
    }

    function renderPreferredSitesList() {
      const container = document.getElementById('preferred-sites-list');
      container.innerHTML = '';
      
      if (modePreferredSites.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.className = 'text-gray-500 text-sm italic text-center py-4';
        emptyMsg.textContent = 'No preferred sites added yet';
        container.appendChild(emptyMsg);
        return;
      }
      
      modePreferredSites.forEach((site, index) => {
        const siteItem = createSiteListItem(site, index, 'preferred');
        container.appendChild(siteItem);
      });
    }

    function renderBlockedSitesList() {
      const container = document.getElementById('blocked-sites-list');
      container.innerHTML = '';
      
      if (modeBlockedSites.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.className = 'text-gray-500 text-sm italic text-center py-4';
        emptyMsg.textContent = 'No blocked sites added yet';
        container.appendChild(emptyMsg);
        return;
      }
      
      modeBlockedSites.forEach((site, index) => {
        const siteItem = createSiteListItem(site, index, 'blocked');
        container.appendChild(siteItem);
      });
    }

    function createSiteListItem(site, index, type) {
      const item = document.createElement('div');
      item.className = 'flex items-center gap-2 p-3 bg-gray-50 rounded-lg border';
      item.dataset.index = index;
      
      // Priority number for preferred sites
      if (type === 'preferred') {
        const priorityBadge = document.createElement('span');
        priorityBadge.className = 'bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full min-w-[24px] text-center';
        priorityBadge.textContent = index + 1;
        item.appendChild(priorityBadge);
      }
      
      // Site URL
      const siteUrl = document.createElement('span');
      siteUrl.className = 'flex-1 text-sm text-gray-700 break-all';
      siteUrl.textContent = site;
      item.appendChild(siteUrl);
      
      // Action buttons
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'flex gap-1';
      
      // Edit button
      const editBtn = document.createElement('button');
      editBtn.className = 'text-blue-600 hover:text-blue-800 text-sm px-2 py-1 rounded hover:bg-blue-50';
      editBtn.textContent = 'Edit';
      editBtn.addEventListener('click', () => editSite(site, index, type));
      buttonContainer.appendChild(editBtn);
      
      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50';
      deleteBtn.textContent = 'Delete';
      deleteBtn.addEventListener('click', () => deleteSite(index, type));
      buttonContainer.appendChild(deleteBtn);
      
      // Move up button (for preferred sites only)
      if (type === 'preferred' && index > 0) {
        const moveUpBtn = document.createElement('button');
        moveUpBtn.className = 'text-gray-600 hover:text-gray-800 text-sm px-2 py-1 rounded hover:bg-gray-50';
        moveUpBtn.textContent = '↑';
        moveUpBtn.title = 'Move up';
        moveUpBtn.addEventListener('click', () => moveSite(index, index - 1, type));
        buttonContainer.appendChild(moveUpBtn);
      }
      
      // Move down button (for preferred sites only)
      if (type === 'preferred' && index < modePreferredSites.length - 1) {
        const moveDownBtn = document.createElement('button');
        moveDownBtn.className = 'text-gray-600 hover:text-gray-800 text-sm px-2 py-1 rounded hover:bg-gray-50';
        moveDownBtn.textContent = '↓';
        moveDownBtn.title = 'Move down';
        moveDownBtn.addEventListener('click', () => moveSite(index, index + 1, type));
        buttonContainer.appendChild(moveDownBtn);
      }
      
      item.appendChild(buttonContainer);
      return item;
    }

    function isValidUrlOrWildcard(url) {
      // Check if it's a valid URL first
      try {
        new URL(url);
        return true;
      } catch {
        // If not a valid URL, check if it's a wildcard pattern
        // Allow patterns like *.domain.com, *.subdomain.domain.com, etc.
        const wildcardPattern = /^\*\.([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)*[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?$/;
        return wildcardPattern.test(url);
      }
    }

    function addSite(type) {
      const inputId = type === 'preferred' ? 'preferred-site-input' : 'blocked-site-input';
      const input = document.getElementById(inputId);
      const url = input.value.trim();
      
      if (!url) {
        alert('Please enter a valid URL');
        return;
      }
      
      // Check maximum limits
      if (type === 'preferred' && modePreferredSites.length >= MAX_PREFERRED_SITES) {
        alert(`Maximum of ${MAX_PREFERRED_SITES} preferred sites allowed. Please remove some sites before adding new ones.`);
        return;
      }
      
      if (type === 'blocked' && modeBlockedSites.length >= MAX_BLOCKED_SITES) {
        alert(`Maximum of ${MAX_BLOCKED_SITES} blocked sites allowed. Please remove some sites before adding new ones.`);
        return;
      }
      
      // Enhanced URL validation that allows wildcards
      if (!isValidUrlOrWildcard(url)) {
        alert('Please enter a valid URL or wildcard pattern (e.g., https://example.com or *.example.com)');
        return;
      }
      
      if (type === 'preferred') {
        modePreferredSites.push(url);
        renderPreferredSitesList();
        updateSiteCounts();
      } else {
        modeBlockedSites.push(url);
        renderBlockedSitesList();
        updateSiteCounts();
      }
      
      input.value = '';
    }

    function editSite(site, index, type) {
      const newUrl = prompt('Edit site URL:', site);
      if (newUrl === null) return; // User cancelled
      
      const trimmedUrl = newUrl.trim();
      if (!trimmedUrl) {
        alert('URL cannot be empty');
        return;
      }
      
      // Enhanced URL validation that allows wildcards
      if (!isValidUrlOrWildcard(trimmedUrl)) {
        alert('Please enter a valid URL or wildcard pattern (e.g., https://example.com or *.example.com)');
        return;
      }
      
      if (type === 'preferred') {
        modePreferredSites[index] = trimmedUrl;
        renderPreferredSitesList();
      } else {
        modeBlockedSites[index] = trimmedUrl;
        renderBlockedSitesList();
      }
    }

    function deleteSite(index, type) {
      if (!confirm('Are you sure you want to delete this site?')) return;
      
      if (type === 'preferred') {
        modePreferredSites.splice(index, 1);
        renderPreferredSitesList();
        updateSiteCounts();
      } else {
        modeBlockedSites.splice(index, 1);
        renderBlockedSitesList();
        updateSiteCounts();
      }
    }

    function moveSite(fromIndex, toIndex, type) {
      if (type === 'preferred') {
        const site = modePreferredSites[fromIndex];
        modePreferredSites.splice(fromIndex, 1);
        modePreferredSites.splice(toIndex, 0, site);
        renderPreferredSitesList();
      }
    }

    // Event listeners
    document.getElementById('add-preferred-site').addEventListener('click', () => addSite('preferred'));
    document.getElementById('add-blocked-site').addEventListener('click', () => addSite('blocked'));
    
    // Allow Enter key to add sites
    document.getElementById('preferred-site-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addSite('preferred');
      }
    });
    
    document.getElementById('blocked-site-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addSite('blocked');
      }
    });

    document.getElementById('test-btn').addEventListener('click', () => {
      const results = document.getElementById('test-results');
      
      results.innerHTML = `
        <h3 class="font-semibold mb-2">Test Results:</h3>
        <p><strong>Preferred Sites (${modePreferredSites.length}):</strong></p>
        <ul class="list-disc pl-5 mb-2">
          ${modePreferredSites.map((site, i) => `<li>${i + 1}. ${site}</li>`).join('')}
        </ul>
        <p><strong>Blocked Sites (${modeBlockedSites.length}):</strong></p>
        <ul class="list-disc pl-5 mb-2">
          ${modeBlockedSites.map(site => `<li>${site}</li>`).join('')}
        </ul>
        <p class="text-green-600 mt-2">✅ List-based site management working correctly!</p>
        <p class="text-sm text-gray-600 mt-2">Features tested: Add, Edit, Delete, Move (preferred sites), URL validation, Wildcard support (*.domain.com), Site limits (30 max each)</p>
      `;
    });

    // Initialize with some test data including wildcards
    renderSiteLists(['https://example.com', '*.bidcentral.ca'], ['*.blocked.com', 'https://spam.com']);
  </script>
</body>
</html>
